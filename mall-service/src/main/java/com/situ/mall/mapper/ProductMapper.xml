<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.situ.mall.mapper.ProductMapper">
	<resultMap id="BaseResultMap" type="com.situ.mall.bean.Product">
		<constructor>
			<idArg column="id" jdbcType="INTEGER" javaType="java.lang.Integer" />
			<arg column="category_id" jdbcType="INTEGER" javaType="java.lang.Integer" />
			<arg column="name" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="subtitle" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="main_image" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="sub_images" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="detail" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="price" jdbcType="DECIMAL" javaType="java.math.BigDecimal" />
			<arg column="stock" jdbcType="INTEGER" javaType="java.lang.Integer" />
			<arg column="status" jdbcType="INTEGER" javaType="java.lang.Integer" />
			<arg column="create_time" jdbcType="TIMESTAMP" javaType="java.util.Date" />
			<arg column="update_time" jdbcType="TIMESTAMP" javaType="java.util.Date" />
		</constructor>
	</resultMap>
	<sql id="Base_Column_List">
		id, category_id, name, subtitle, main_image, sub_images,
		detail, price,
		stock, status,
		create_time, update_time
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from product
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		delete from
		product
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.situ.mall.bean.Product">
		insert into product (id,
		category_id, name,
		subtitle, main_image, sub_images,
		detail, price,
		stock,
		status, create_time, update_time
		)
		values (#{id,jdbcType=INTEGER},
		#{categoryId,jdbcType=INTEGER},
		#{name,jdbcType=VARCHAR},
		#{subtitle,jdbcType=VARCHAR}, #{mainImage,jdbcType=VARCHAR},
		#{subImages,jdbcType=VARCHAR},
		#{detail,jdbcType=VARCHAR},
		#{price,jdbcType=DECIMAL},
		#{stock,jdbcType=INTEGER},
		#{status,jdbcType=INTEGER}, now(),
		now()
		)
	</insert>
	<insert id="insertSelective" parameterType="com.situ.mall.bean.Product">
		insert into product
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="categoryId != null">
				category_id,
			</if>
			<if test="name != null">
				name,
			</if>
			<if test="subtitle != null">
				subtitle,
			</if>
			<if test="mainImage != null">
				main_image,
			</if>
			<if test="subImages != null">
				sub_images,
			</if>
			<if test="detail != null">
				detail,
			</if>
			<if test="price != null">
				price,
			</if>
			<if test="stock != null">
				stock,
			</if>
			<if test="status != null">
				status,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="categoryId != null">
				#{categoryId,jdbcType=INTEGER},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="subtitle != null">
				#{subtitle,jdbcType=VARCHAR},
			</if>
			<if test="mainImage != null">
				#{mainImage,jdbcType=VARCHAR},
			</if>
			<if test="subImages != null">
				#{subImages,jdbcType=VARCHAR},
			</if>
			<if test="detail != null">
				#{detail,jdbcType=VARCHAR},
			</if>
			<if test="price != null">
				#{price,jdbcType=DECIMAL},
			</if>
			<if test="stock != null">
				#{stock,jdbcType=INTEGER},
			</if>
			<if test="status != null">
				#{status,jdbcType=INTEGER},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updateTime != null">
				#{updateTime,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.situ.mall.bean.Product">
		update product
		<set>
			<if test="categoryId != null">
				category_id = #{categoryId,jdbcType=INTEGER},
			</if>
			<if test="name != null">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="subtitle != null">
				subtitle = #{subtitle,jdbcType=VARCHAR},
			</if>
			<if test="mainImage != null">
				main_image = #{mainImage,jdbcType=VARCHAR},
			</if>
			<if test="subImages != null">
				sub_images = #{subImages,jdbcType=VARCHAR},
			</if>
			<if test="detail != null">
				detail = #{detail,jdbcType=VARCHAR},
			</if>
			<if test="price != null">
				price = #{price,jdbcType=DECIMAL},
			</if>
			<if test="stock != null">
				stock = #{stock,jdbcType=INTEGER},
			</if>
			<if test="status != null">
				status = #{status,jdbcType=INTEGER},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<!-- <if test="updateTime != null"> update_time = #{updateTime,jdbcType=TIMESTAMP}, 
				</if> -->
		</set>
		, update_time =now()
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.situ.mall.bean.Product">
		update product
		set
		category_id = #{categoryId,jdbcType=INTEGER},
		name =
		#{name,jdbcType=VARCHAR},
		subtitle = #{subtitle,jdbcType=VARCHAR},
		main_image = #{mainImage,jdbcType=VARCHAR},
		sub_images =
		#{subImages,jdbcType=VARCHAR},
		detail = #{detail,jdbcType=VARCHAR},
		price = #{price,jdbcType=DECIMAL},
		stock = #{stock,jdbcType=INTEGER},
		status = #{status,jdbcType=INTEGER},
		create_time =
		#{createTime,jdbcType=TIMESTAMP},
		update_time =
		#{updateTime,jdbcType=TIMESTAMP}
		where id = #{id,jdbcType=INTEGER}
	</update>
	<select id="pageList" resultMap="BaseResultMap"
		parameterType="com.situ.mall.vo.ProductSearchCondition">
		select
		<include refid="Base_Column_List" />
		from product
		<where>
			<if test="sc_name!=null"><!-- sc_name前段传过来的属性值 -->
				and name like concat('%',#{sc_name},'%')
			</if>
			<if test="sc_subtitle!=null">
				and subtitle like concat('%',#{sc_subtitle},'%')
			</if>
			<if test="beginTime!=null and endTime!=null">
				and create_time between #{beginTime} and #{endTime}
			</if>

		</where>
	</select>
	<delete id="deleteBatch">
		delete from
		product
		where id in
		<foreach collection="array" item="id" open="(" close=")"
			separator=",">
			#{id}
		</foreach>
	</delete>
	<!-- <select id="getTopCategoryIdById" parameterType="int" > select </select> -->
	<!-- 获取二级分类名称 -->
	<select id="getSecondCategoryNameByProductId" parameterType="int"
		resultType="string">
		SELECT NAME FROM category WHERE id=(SELECT category_id FROM
		product WHERE id=#{id})
	</select>
	<!-- 获取一级分类名称 -->
	<select id="getTopCategoryNameByProductId" parameterType="int"
		resultType="string">
		SELECT NAME FROM category WHERE id=(SELECT parent_id FROM
		category WHERE id= (SELECT category_id FROM product WHERE id=#{id}))
	</select>
	<!-- 获取二级分类中所有商品名称 -->
	<select id="selectProductsByParentId" parameterType="int"
		resultMap="BaseResultMap">
		SELECT
		<include refid="Base_Column_List" />
		FROM product
		WHERE category_id = #{categoryId};
	</select>
	
	<select id="selectByProductName" parameterType="com.situ.mall.vo.ProductSearchCondition"
		resultMap="BaseResultMap">
		SELECT
		<include refid="Base_Column_List" />
		FROM product
		<where>
			<if test="sc_name!=null">
				and name like concat('%',#{sc_name},'%')
			</if>
		</where>
	</select>

	<select id="selectProductByPrimaryKey" parameterType="int"
		resultMap="BaseResultMap">
		SELECT
		<include refid="Base_Column_List" />
		FROM product
		WHERE id = #{productId};
	</select>

	<!-- 获取商品的库存量 -->
	<select id="getProductStock" parameterType="int" resultType="int">
		SELECT
		stock
		FROM product
		WHERE id = #{productId};
	</select>

</mapper>